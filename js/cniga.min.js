function snap(e,t){for(var n=e.length-1;n>=0&&(e[n]!==t||(e.splice(n,1),!0!==multi));n--);}function trackEvent(e,t,n,o){o?(_paq.push(["trackEvent",e,t,n,o]),console.log("CATEGORY: "+e+", ACTION:"+t+", LABEL:"+n+", VALUE:"+o)):n?(_paq.push(["trackEvent",e,t,n]),console.log("CATEGORY: "+e+", ACTION:"+t+", LABEL:"+n)):(_paq.push(["trackEvent",e,t]),console.log("CATEGORY: "+e+", ACTION:"+t))}var _paq=_paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),window.onload=function(){var e="https://circle.red/stats/";_paq.push(["setTrackerUrl",e+"piwik.php"]),_paq.push(["setSiteId","2"]);var t=document,n=t.createElement("script"),o=t.getElementsByTagName("script")[0];n.type="text/javascript",n.async=!0,n.defer=!0,n.src=e+"piwik.js",o.parentNode.insertBefore(n,o)};var windowHeight=window.innerHeight,app=new Vue({el:"#app",data:{my:{userType:"guest",view:"welcome",contactChoice:!1,contactEmail:"",readItems:[],unreadItems:0,sentBills:[],expandedBills:[],email:"",loginCode:"",authToken:""},loginStatus:"guest",news:[],billsLoading:!0,stateSupport:{},stateSupportShow:!1,stateOppose:{},stateOpposeShow:!1,stateMonitor:{},stateMonitorShow:!1,schedule:{},scheduleShow:!1},computed:{myNews:function(){var e=this;return e.news.map(function(t){return-1!==e.my.readItems.indexOf(t.slug)&&(t.read=!0),t})}},methods:{checkEmail:function(){var e=this,t="http://204.232.242.150:8008/api/Registration/ValidateEmailAddressAndSendEmailToMember?emailAddress="+encodeURIComponent(e.my.email);e.loginStatus="checking",fetch(t).then(function(e){return e.json()}).then(function(t){console.log(t),t.success?e.loginStatus="validating":e.loginStatus="error"}).then(function(){console.log("second success")}).catch(function(e){console.log(e)})},checkLoginCode:function(){var e=this,t=e.my.loginCode.toUpperCase(),n="http://204.232.242.150:8008/api/Registration/VerifyRegistrationCodeAndCreateUser?emailAddress="+encodeURIComponent(e.my.email)+"&registrationCode="+encodeURIComponent(t);fetch(n).then(function(e){return e.json()}).then(function(t){t.success?(e.loginStatus="member",e.my.userType="member",e.my.view="news",e.my.authToken=t.cnigaAuthToken,e.countUnreadNews(),e.bindEvents(),e.getContent(),e.getBills()):e.loginStatus="validateError"}).catch(function(e){console.log(e)})},newAlert:function(e){alert(e)},beforeEnter:function(e){e.style.opacity=0},slideDown:function(e,t){Velocity(e,"slideDown",{duration:500})},slideUp:function(e,t){Velocity(e,"slideUp",{duration:300})},openLink:function(e,t){"undefined"!=typeof cordova&&(window.open=cordova.InAppBrowser.open),window.open(e,t)},emailLink:function(e,t){return"mailto:?subject="+e+"&body="+t},markNewsRead:function(e){-1===this.my.readItems.indexOf(e)&&this.my.readItems.push(e),this.countUnreadNews()},countUnreadNews:function(){var e=this;e.my.unreadItems=0,e.news.map(function(t){-1===e.my.readItems.indexOf(t.slug)&&e.my.unreadItems++})},bindEvents:function(){console.log("Bind Events"),document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){this.deviceready=!0,console.log("Received Device Ready Event"),console.log("calling setup push"),app.setupPush()},setupPush:function(){var e=this;console.log("calling push init");var t=PushNotification.init({android:{icon:"ic_stat_onesignal_default",iconColor:"#f26c51",senderID:"1098348384269"},browser:{},ios:{sound:!0,vibration:!0,badge:!0},windows:{}});console.log("after init"),t.on("registration",function(t){console.log("registration event: "+t.registrationId),console.log("Device Type: "+t.registrationType);var n="FCM"===t.registrationType?1:2;fetch("http://204.232.242.150:8008/api/Device/UpdateMemberDeviceInfo?authToken="+e.my.authToken+"&deviceType="+n+"&deviceId="+t.registrationId).then(function(){console.log("Device added to database")}).catch(function(e){console.log(e)});localStorage.getItem("registrationId")!==t.registrationId&&localStorage.setItem("registrationId",t.registrationId)}),t.on("error",function(e){console.log("push error = "+e.message)}),t.on("notification",function(e){console.log("notification event"),navigator.notification.alert(e.message,null,e.title,"Ok")})},getContent:function(){var e=this;fetch("https://circle.red/cniga/").then(function(e){return e.json()}).then(function(t){e.schedule=t.schedule,e.news=t.news,e.countUnreadNews()}).catch(function(t){console.log(t),e.countUnreadNews()})},getBills:function(){var e=this;fetch("https://circle.red/cniga/legislation").then(function(e){return e.json()}).then(function(t){e.stateSupport=t.billssupporting,e.stateOppose=t.billsopposing,e.stateMonitor=t.billsmonitoring,e.billsLoading=!1}).catch(function(e){console.log(e)})},toggleEmailSent:function(e){-1===this.my.sentBills.indexOf(e)?this.my.sentBills.push(e):this.my.sentBills.splice(this.my.sentBills.indexOf(e),1),trackEvent("Member marked email sent",e)},toggleBillCollapse:function(e){if(this.my.expandedBills.includes(e)){var t=this.my.expandedBills.indexOf(e);-1!=t&&this.my.expandedBills.splice(t,1)}else this.my.expandedBills.push(e)},getMyData:function(){var e=this;e.getObjectStore("my","readonly").openCursor().onsuccess=function(t){var n=t.target.result;if(n){e.my=n.value;var o=JSON.stringify(e.my.authToken,null,2);o=o.replace(/"/g,""),fetch("http://204.232.242.150:8008/api/Registration/VerifyToken?token="+encodeURIComponent(o)).then(function(e){return e.json()}).then(function(t){t.isValid?e.error_msg?e.my.view="error":(e.countUnreadNews(),e.bindEvents(),e.getContent(),e.getBills(),e.my.view="news"):(e.loginStatus="guest",e.my.userType="guest",e.my.view="welcome")}).catch(function(e){console.log("Error"+e)})}}},updateMyData:function(){var e=this,t=e.getObjectStore("my","readwrite");t.count().onsuccess=function(n){if(0===n.target.result)try{t.add(e.my,0)}catch(e){throw e}else{t.openCursor().onsuccess=function(t){var n=t.target.result;if(n)try{n.update(e.my)}catch(e){throw e}}}}},getObjectStore:function(e,t){return this.db.transaction(e,t).objectStore(e)},trackEvent:function(e,t,n,o){o?(_paq.push(["trackEvent",e,t,n,o]),console.log("CATEGORY: "+e+", ACTION:"+t+", LABEL:"+n+", VALUE:"+o)):n?(_paq.push(["trackEvent",e,t,n]),console.log("CATEGORY: "+e+", ACTION:"+t+", LABEL:"+n)):(_paq.push(["trackEvent",e,t]),console.log("CATEGORY: "+e+", ACTION:"+t))},sendContactEmail:function(e){if("form"===this.my.contactChoice)var t="Form request from "+this.my.email;else if("question"===this.my.contactChoice)t="Question from "+this.my.email;var n=new FormData;n.append("subject",t),n.append("message",this.my.contactEmail),n.append("sender",this.my.email),fetch("https://circle.red/cniga/mail.php",{method:"POST",body:n}).then(function(e){console.log(e)}).catch(function(e){console.error(e)})}},mounted:function(){var e=this,t=indexedDB.open("CNIGAApp",3);t.onerror=function(t){e.indexed="Can't use IndexedDB"},t.onsuccess=function(t){e.db=this.result,e.getMyData()},t.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore("my")}},updated:function(){var e=this,t=indexedDB.open("CNIGAApp",3);t.onerror=function(t){e.indexed="Can't use IndexedDB"},t.onsuccess=function(t){e.db=this.result,e.updateMyData()},t.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore("my")}}});
//# sourceMappingURL=cniga.min.js.map