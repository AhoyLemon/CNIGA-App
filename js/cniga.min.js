function snap(e,t){for(var n=e.length-1;0<=n&&(e[n]!==t||(e.splice(n,1),!0!==multi));n--);}function trackEvent(e,t,n,o){o?(_paq.push(["trackEvent",e,t,n,o]),console.log("CATEGORY: "+e+", ACTION:"+t+", LABEL:"+n+", VALUE:"+o)):n?(_paq.push(["trackEvent",e,t,n]),console.log("CATEGORY: "+e+", ACTION:"+t+", LABEL:"+n)):(_paq.push(["trackEvent",e,t]),console.log("CATEGORY: "+e+", ACTION:"+t))}var _paq=_paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),window.onload=function(){var e="https://circle.red/stats/";_paq.push(["setTrackerUrl",e+"piwik.php"]),_paq.push(["setSiteId","2"]);var t=document,n=t.createElement("script"),o=t.getElementsByTagName("script")[0];n.type="text/javascript",n.async=!0,n.defer=!0,n.src=e+"piwik.js",o.parentNode.insertBefore(n,o)};var windowHeight=window.innerHeight,authURL="http://204.232.242.136:8008",app=new Vue({el:"#app",data:{my:{userType:"guest",view:"welcome",contactChoice:!1,contactEmail:"",readItems:[],unreadItems:0,sentBills:[],expandedBills:[],email:"",loginCode:"",authToken:""},loginStatus:"guest",news:[],billsLoading:!0,stateSupport:{},stateSupportShow:!1,stateOppose:{},stateOpposeShow:!1,stateMonitor:{},stateMonitorShow:!1,schedule:{},scheduleShow:!1},computed:{myNews:function(){var t=this;return t.news.map(function(e){return-1!==t.my.readItems.indexOf(e.slug)&&(e.read=!0),e})}},methods:{checkEmail:function(){var t=this,e=authURL+"/api/Registration/ValidateEmailAddressAndSendEmailToMember?emailAddress="+encodeURIComponent(t.my.email);t.loginStatus="checking",fetch(e).then(function(e){return e.json()}).then(function(e){console.log(e),e.success?t.loginStatus="validating":t.loginStatus="error"}).then(function(){console.log("second success")}).catch(function(e){console.log(e)})},checkLoginCode:function(){var t=this,e=t.my.loginCode.toUpperCase(),n=authURL+"/api/Registration/VerifyRegistrationCodeAndCreateUser?emailAddress="+encodeURIComponent(t.my.email)+"&registrationCode="+encodeURIComponent(e);fetch(n).then(function(e){return e.json()}).then(function(e){e.success?(t.loginStatus="member",t.my.userType="member",t.my.view="news",t.my.authToken=e.cnigaAuthToken,t.countUnreadNews(),t.bindEvents(),t.getContent(),t.getBills()):t.loginStatus="validateError"}).catch(function(e){console.log(e)})},newAlert:function(e){alert(e)},beforeEnter:function(e){e.style.opacity=0},slideDown:function(e,t){Velocity(e,"slideDown",{duration:500})},slideUp:function(e,t){Velocity(e,"slideUp",{duration:300})},openLink:function(e,t){"undefined"!=typeof cordova&&(window.open=cordova.InAppBrowser.open),window.open(e,t)},emailLink:function(e,t){return"mailto:?subject="+e+"&body="+t},markNewsRead:function(e){var t=this;-1===t.my.readItems.indexOf(e)&&t.my.readItems.push(e),t.countUnreadNews()},countUnreadNews:function(){var t=this;t.my.unreadItems=0,t.news.map(function(e){-1===t.my.readItems.indexOf(e.slug)&&t.my.unreadItems++})},bindEvents:function(){console.log("Bind Events"),document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){this.deviceready=!0,console.log("Received Device Ready Event"),console.log("calling setup push"),app.setupPush()},setupPush:function(){var n=this;console.log("calling push init");var e=PushNotification.init({android:{icon:"white",iconColor:"#f26c51",senderID:"1098348384269"},browser:{},ios:{sound:!0,vibration:!0,badge:!0},windows:{}});console.log("after init"),e.on("registration",function(e){console.log("registration event: "+e.registrationId),console.log("Device Type: "+e.registrationType);var t="FCM"===e.registrationType?1:2;fetch(authURL+"/api/Device/UpdateMemberDeviceInfo?authToken="+n.my.authToken+"&deviceType="+t+"&deviceId="+e.registrationId).then(function(){console.log("Device added to database")}).catch(function(e){console.log(e)}),localStorage.getItem("registrationId")!==e.registrationId&&localStorage.setItem("registrationId",e.registrationId)}),e.on("error",function(e){console.log("push error = "+e.message)}),e.on("notification",function(e){console.log("notification event"),navigator.notification.alert(e.message,null,e.title,"Ok")})},getContent:function(){var t=this;fetch("https://circle.red/cniga/").then(function(e){return e.json()}).then(function(e){t.schedule=e.schedule,t.news=e.news,t.countUnreadNews()}).catch(function(e){console.log(e),t.countUnreadNews()})},getBills:function(){var t=this;fetch("https://circle.red/cniga/legislation").then(function(e){return e.json()}).then(function(e){t.stateSupport=e.billssupporting,t.stateOppose=e.billsopposing,t.stateMonitor=e.billsmonitoring,t.billsLoading=!1}).catch(function(e){console.log(e)})},toggleEmailSent:function(e){-1===this.my.sentBills.indexOf(e)?this.my.sentBills.push(e):this.my.sentBills.splice(this.my.sentBills.indexOf(e),1),trackEvent("Member marked email sent",e)},toggleBillCollapse:function(e){if(this.my.expandedBills.includes(e)){var t=this.my.expandedBills.indexOf(e);-1!=t&&this.my.expandedBills.splice(t,1)}else this.my.expandedBills.push(e)},getMyData:function(){var o=this;o.getObjectStore("my","readonly").openCursor().onsuccess=function(e){var t=e.target.result;if(t){o.my=t.value;var n=JSON.stringify(o.my.authToken,null,2);n=n.replace(/"/g,""),fetch(authURL+"/api/Registration/VerifyToken?token="+encodeURIComponent(n)).then(function(e){return e.json()}).then(function(e){e.isValid?o.error_msg?o.my.view="error":(o.countUnreadNews(),o.bindEvents(),o.getContent(),o.getBills(),o.my.view="news"):(o.loginStatus="guest",o.my.userType="guest",o.my.view="welcome")}).catch(function(e){console.log("Error"+e)})}}},updateMyData:function(){var n=this,t=n.getObjectStore("my","readwrite");t.count().onsuccess=function(e){if(0===e.target.result)try{t.add(n.my,0)}catch(e){throw e}else t.openCursor().onsuccess=function(e){var t=e.target.result;if(t)try{t.update(n.my)}catch(e){throw e}}}},getObjectStore:function(e,t){return this.db.transaction(e,t).objectStore(e)},trackEvent:function(e,t,n,o){o?(_paq.push(["trackEvent",e,t,n,o]),console.log("CATEGORY: "+e+", ACTION:"+t+", LABEL:"+n+", VALUE:"+o)):n?(_paq.push(["trackEvent",e,t,n]),console.log("CATEGORY: "+e+", ACTION:"+t+", LABEL:"+n)):(_paq.push(["trackEvent",e,t]),console.log("CATEGORY: "+e+", ACTION:"+t))},sendContactEmail:function(e){e.preventDefault();var t=this;if(console.log(t.my.contactEmail),"form"===t.my.contactChoice)var n="Form request from "+t.my.email;else if("question"===t.my.contactChoice)n="Question from "+t.my.email;var o=new FormData;return o.append("subject",n),o.append("message",t.my.contactEmail),o.append("sender",t.my.email),fetch("https://circle.red/cniga/mail.php",{method:"POST",body:o}).then(function(e){console.log(e)}).catch(function(e){console.error(e)}),t.my.contactChoice=!1,t.my.contactEmail="",!1}},mounted:function(){var t=this,e=indexedDB.open("CNIGAApp",3);e.onerror=function(e){t.indexed="Can't use IndexedDB"},e.onsuccess=function(e){t.db=this.result,t.getMyData()},e.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore("my")}},updated:function(){var t=this,e=indexedDB.open("CNIGAApp",3);e.onerror=function(e){t.indexed="Can't use IndexedDB"},e.onsuccess=function(e){t.db=this.result,t.updateMyData()},e.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore("my")}}});
//# sourceMappingURL=cniga.min.js.map